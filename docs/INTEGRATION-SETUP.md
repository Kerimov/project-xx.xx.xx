# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å 1–°:–£–•

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **URL API 1–°**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å `http://server:port/api` –Ω–∞ `http://server:port/ecof` (–∫–æ—Ä–Ω–µ–≤–æ–π URL –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ HTTP-—Å–µ—Ä–≤–∏—Å–∞)
2. **–§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞**: –£–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –ø–æ–ª—è `operationType` –∏ `documentId`, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `{ payload: {...} }` –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç 1–°
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ payload**: –í—Å–µ –ø–æ–ª—è (–≤–∫–ª—é—á–∞—è `items`) —Ç–µ–ø–µ—Ä—å –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ payload, –∞ –Ω–µ –≤–ª–æ–∂–µ–Ω—ã –≤ `data`

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –í —Ñ–∞–π–ª–µ `backend/.env` —É–∫–∞–∂–∏—Ç–µ:

```env
# –ë–∞–∑–æ–≤—ã–π URL —Å–µ—Ä–≤–∏—Å–∞ 1–° (–±–µ–∑ /api –≤ –∫–æ–Ω—Ü–µ!)
UH_API_URL=http://–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-1—Å:8080/ecof
UH_API_USER=–ª–æ–≥–∏–Ω_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è_1—Å
UH_API_PASSWORD=–ø–∞—Ä–æ–ª—å_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è_1—Å
UH_API_TIMEOUT=30000
```

**–í–∞–∂–Ω–æ**: 
- URL –¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ `/ecof` (–∏–ª–∏ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ **–ö–æ—Ä–Ω–µ–≤–æ–πURL** –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ HTTP-—Å–µ—Ä–≤–∏—Å–∞ –≤ 1–°)
- –ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ `/api` –≤ –∫–æ–Ω—Ü–µ!

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
‚úÖ UH queue processor started
‚úÖ NSI sync service started
```

–ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–°, –æ–Ω–∏ –±—É–¥—É—Ç –≤ –ª–æ–≥–∞—Ö.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –≤ 1–°

1. **–°–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞** ‚Üí —Å—Ç–∞—Ç—É—Å `Draft`
2. **–ó–∞–º–æ—Ä–æ–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞** (`freeze`) ‚Üí —Å—Ç–∞—Ç—É—Å `Frozen` ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –£–•
3. **–û—á–µ—Ä–µ–¥—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è** ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ 1–° —á–µ—Ä–µ–∑ HTTP API
4. **–£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** ‚Üí —Å—Ç–∞—Ç—É—Å `SentToUH`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `uh_document_ref`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ payload –¥–ª—è 1–°

```json
{
  "payload": {
    "portalDocId": "uuid",
    "portalVersion": 1,
    "idempotencyKey": "uuid-v1-timestamp",
    "sourceCompany": "–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏",
    "type": "GoodsReceipt",
    "number": "000001",
    "date": "2026-01-29",
    "counterpartyName": "–û–û–û –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç",
    "counterpartyInn": "1234567890",
    "amount": 1000,
    "totalAmount": 1000,
    "currency": "RUB",
    "items": [
      {
        "nomenclatureName": "–¢–æ–≤–∞—Ä",
        "quantity": 10,
        "unit": "—à—Ç",
        "price": 100,
        "amount": 1000
      }
    ],
    "warehouseId": "uuid",
    "contractId": "uuid",
    // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –∏–∑ versionData
  }
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ health check 1–°

```bash
curl -u –ª–æ–≥–∏–Ω:–ø–∞—Ä–æ–ª—å http://—Å–µ—Ä–≤–µ—Ä:8080/ecof/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON —Å –ø–æ–ª–µ–º `status`.

### 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç–∞–ª: http://localhost:5173
2. –°–æ–∑–¥–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤")
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ
4. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–º–æ—Ä–æ–∑–∏—Ç—å" ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–∏—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥—å –£–•

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—á–µ—Ä–µ–¥–∏

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üì• Added to UH queue: UpsertDocument for document <id>
üì¶ Processing 1 items from UH queue
üì§ Sending document to UH: <id>
‚úÖ Document sent to UH successfully: <uh_document_ref>
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–í –∫–∞—Ä—Ç–æ—á–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- **–°—Ç–∞—Ç—É—Å –ø–æ—Ä—Ç–∞–ª–∞**: `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –£–•`
- **–°—Ç–∞—Ç—É—Å –£–•**: `Accepted` (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Å—Ç–∞—Ç—É—Å –∏–∑ 1–°)
- **–°—Å—ã–ª–∫–∞ –£–•**: —Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç –≤ 1–°

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ 1–°

**–°–∏–º–ø—Ç–æ–º**: –í –ª–æ–≥–∞—Ö `‚ùå Failed to send document to UH`

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `UH_API_URL` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `http://—Å–µ—Ä–≤–µ—Ä:–ø–æ—Ä—Ç/ecof`, –±–µ–∑ `/api`)
2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ 1–° –∏–∑ —Å–µ—Ç–∏ –±—ç–∫–µ–Ω–¥–∞
3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è (`UH_API_USER`, `UH_API_PASSWORD`)
4. –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –ª–∏ HTTP-—Å–µ—Ä–≤–∏—Å –≤ 1–° (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ)

### –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**:
1. –°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `Frozen` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
2. –õ–æ–≥–∏ –±—ç–∫–µ–Ω–¥–∞ ‚Äî –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
3. –¢–∞–±–ª–∏—Ü—É `uh_integration_queue` –≤ –ë–î ‚Äî —Å—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á (`Pending`, `Failed`, `Completed`)

### –û—à–∏–±–∫–∞ 404 –æ—Ç 1–°

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –∏–ª–∏ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω HTTP-—Å–µ—Ä–≤–∏—Å

**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `UH_API_URL` –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ 1–°

## API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

- `GET /api/admin/queue/stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–¥–º–∏–Ω-–ø—Ä–∞–≤)
- `GET /api/admin/queue/items` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –æ—á–µ—Ä–µ–¥–∏ (—Ç—Ä–µ–±—É–µ—Ç –∞–¥–º–∏–Ω-–ø—Ä–∞–≤)
- `GET /api/documents/:id` ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ–∫—É–º–µ–Ω—Ç–µ, –≤–∫–ª—é—á–∞—è `uh_status` –∏ `uh_document_ref`

## UI –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–û—Ç–∫—Ä–æ–π—Ç–µ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –£–•** –≤ –º–µ–Ω—é –ø–æ—Ä—Ç–∞–ª–∞ ‚Äî —Ç–∞–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–∏ (–≤ –æ—á–µ—Ä–µ–¥–∏, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –∑–∞–≤–µ—Ä—à–µ–Ω–æ, –æ—à–∏–±–∫–∏)
- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –æ—á–µ—Ä–µ–¥–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏ (–¥–æ–∫—É–º–µ–Ω—Ç, –æ–ø–µ—Ä–∞—Ü–∏—è, —Å—Ç–∞—Ç—É—Å, –ø–æ–ø—ã—Ç–∫–∏, –æ—à–∏–±–∫–∏)
- –ö–Ω–æ–ø–∫–∞ "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ù–°–ò" –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥.
