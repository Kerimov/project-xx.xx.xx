# Роли пользователей и их права доступа

В системе портала ЕЦОФ существует несколько ролей пользователей, каждая из которых имеет определенные права доступа.

## Роли в системе

### 1. **admin** / **ecof_admin** — Администратор

**Описание:** Административные роли с полным доступом к системе управления аналитиками и настройками холдинга.

**Права доступа:**
- ✅ Полный доступ ко всем функциям портала
- ✅ Управление каталогом аналитик (создание/редактирование типов аналитик)
- ✅ Управление значениями аналитик (добавление/обновление элементов справочников)
- ✅ Управление подписками организаций на аналитики (может настраивать подписки для любой организации)
- ✅ Доступ к админ-панели аналитик (`/analytics/admin`)
- ✅ Просмотр и управление всеми документами и пакетами
- ✅ Управление интеграцией с 1С:УХ
- ✅ Просмотр логов и очереди интеграции
- ✅ Управление НСИ (нормативно-справочной информацией)

**Ограничения:**
- ❌ Роль нельзя изменить через личный кабинет организации (защищена от изменения)
- ❌ Роль нельзя отвязать от организации через личный кабинет

**Использование:**
- Администраторы холдинга (ЕЦОФ)
- Сотрудники, ответственные за управление центральным каталогом аналитик

---

### 2. **ecof_user** — Пользователь ЕЦОФ

**Описание:** Пользователь центрального портала ЕЦОФ, работающий на уровне холдинга.

**Права доступа:**
- ✅ Работа с документами и пакетами
- ✅ Просмотр и редактирование документов
- ✅ Создание и управление пакетами документов
- ✅ Отправка документов в 1С:УХ
- ✅ Просмотр справочников (НСИ)
- ✅ Просмотр отчетности
- ✅ Настройка аналитик своей организации (если привязан к организации)
- ✅ Управление сотрудниками своей организации (если привязан к организации)

**Ограничения:**
- ❌ Нет доступа к админ-панели аналитик
- ❌ Не может управлять каталогом аналитик (создавать типы, добавлять значения)
- ❌ Не может управлять подписками других организаций

**Использование:**
- Сотрудники центрального офиса ЕЦОФ
- Пользователи, работающие с документами на уровне холдинга

---

### 3. **company_user** — Пользователь компании

**Описание:** Пользователь дочерней организации (компании), работающий в рамках своей организации.

**Права доступа:**
- ✅ Работа с документами и пакетами своей организации
- ✅ Просмотр и редактирование документов своей организации
- ✅ Создание и управление пакетами документов своей организации
- ✅ Отправка документов в 1С:УХ
- ✅ Просмотр справочников (НСИ)
- ✅ Просмотр отчетности своей организации
- ✅ Настройка аналитик своей организации (подписки на аналитики)
- ✅ Управление сотрудниками своей организации (в личном кабинете)
- ✅ Настройка webhook для получения аналитик

**Ограничения:**
- ❌ Нет доступа к админ-панели аналитик
- ❌ Не может управлять каталогом аналитик (создавать типы, добавлять значения)
- ❌ Не может управлять подписками других организаций
- ❌ Работает только в рамках своей организации (фильтрация по `organization_id`)

**Использование:**
- Сотрудники дочерних организаций (компаний)
- Пользователи, работающие с документами на уровне своей компании

---

### 4. **user** — Пользователь (базовая роль)

**Описание:** Базовая роль с минимальными правами доступа. Используется по умолчанию при регистрации.

**Права доступа:**
- ✅ Базовый доступ к порталу
- ✅ Работа с документами (если привязан к организации)
- ✅ Просмотр справочников (НСИ)

**Ограничения:**
- ❌ Ограниченный функционал по сравнению с другими ролями
- ❌ Может потребоваться повышение роли для полного доступа к функциям

**Использование:**
- Новые пользователи при регистрации
- Пользователи с ограниченными правами доступа

---

## Сравнительная таблица прав доступа

| Функция | admin/ecof_admin | ecof_user | company_user | user |
|---------|------------------|-----------|--------------|------|
| Работа с документами | ✅ Все | ✅ Все | ✅ Своей организации | ✅ Ограниченно |
| Управление пакетами | ✅ Все | ✅ Все | ✅ Своей организации | ✅ Ограниченно |
| Админ-панель аналитик | ✅ | ❌ | ❌ | ❌ |
| Управление каталогом аналитик | ✅ | ❌ | ❌ | ❌ |
| Настройка подписок аналитик | ✅ Все организации | ✅ Своей организации | ✅ Своей организации | ❌ |
| Управление сотрудниками | ✅ | ✅ Своей организации | ✅ Своей организации | ❌ |
| Интеграция с 1С:УХ | ✅ | ✅ | ✅ | ❌ |
| Просмотр логов | ✅ | ✅ | ✅ | ❌ |
| Управление НСИ | ✅ | ✅ | ✅ | ❌ |

---

## Управление ролями

### Изменение роли сотрудника

Роль сотрудника можно изменить в **Личном кабинете организации** (`/organization/cabinet`):

1. Перейдите в раздел "Сотрудники"
2. Нажмите "Изменить роль" у нужного сотрудника
3. Выберите новую роль из списка:
   - `user` — Пользователь
   - `company_user` — Пользователь компании
   - `ecof_user` — Пользователь ЕЦОФ

**Важно:** Роли `admin` и `ecof_admin` нельзя изменить через интерфейс личного кабинета (защищены от изменения).

### Привязка сотрудника к организации

Сотрудника можно привязать к организации в **Личном кабинете организации**:

1. Перейдите в раздел "Сотрудники"
2. Нажмите "Добавить сотрудника"
3. Найдите пользователя по имени или email
4. Выберите пользователя из результатов поиска
5. Пользователь будет привязан к вашей организации

---

## Рекомендации по использованию ролей

1. **admin/ecof_admin**: Используйте только для администраторов холдинга, ответственных за управление центральным каталогом аналитик.

2. **ecof_user**: Используйте для сотрудников центрального офиса ЕЦОФ, работающих с документами на уровне холдинга.

3. **company_user**: Используйте для сотрудников дочерних организаций, работающих в рамках своей компании.

4. **user**: Базовая роль для новых пользователей. При необходимости повышайте до `company_user` или `ecof_user`.

---

## Технические детали

- Роли хранятся в таблице `users` в поле `role`
- Проверка прав доступа выполняется через middleware `requireRole()` в backend
- На фронтенде роли используются для условного отображения элементов интерфейса
- Роли `admin` и `ecof_admin` защищены от изменения в контроллере `updateEmployeeRole`
