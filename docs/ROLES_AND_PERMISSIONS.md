# Роли пользователей и их права доступа

В системе портала ЕЦОФ существует три роли пользователей, каждая из которых имеет определенные права доступа.

## Роли в системе

### 1. **ecof_admin** — Администратор ЕЦОФ

**Описание:** Администратор центрального портала ЕЦОФ с полным доступом ко всему функционалу системы.

**Права доступа:**
- ✅ Полный доступ ко всем функциям портала
- ✅ Управление каталогом аналитик (создание/редактирование типов аналитик)
- ✅ Управление значениями аналитик (добавление/обновление элементов справочников)
- ✅ Управление подписками организаций на аналитики (может настраивать подписки для любой организации)
- ✅ Доступ к админ-панели аналитик (`/analytics/admin`)
- ✅ Просмотр и управление всеми документами и пакетами всех организаций
- ✅ Управление интеграцией с 1С:УХ
- ✅ Просмотр логов и очереди интеграции
- ✅ Управление НСИ (нормативно-справочной информацией)
- ✅ Управление сотрудниками всех организаций

**Ограничения:**
- ❌ Роль нельзя изменить через личный кабинет организации (защищена от изменения)
- ❌ Роль нельзя отвязать от организации через личный кабинет

**Использование:**
- Администраторы холдинга (ЕЦОФ)
- Сотрудники, ответственные за управление центральным каталогом аналитик и всей системой

---

### 2. **org_admin** — Администратор организации

**Описание:** Администратор дочерней организации (компании), работающий в рамках своей организации.

**Права доступа:**
- ✅ Работа с документами и пакетами своей организации
- ✅ Просмотр и редактирование документов своей организации
- ✅ Создание и управление пакетами документов своей организации
- ✅ Отправка документов в 1С:УХ
- ✅ Просмотр справочников (НСИ)
- ✅ Просмотр отчетности своей организации
- ✅ **Настройка аналитик своей организации** (подписки на аналитики)
- ✅ **Управление сотрудниками своей организации** (в личном кабинете)
- ✅ **Настройка webhook для получения аналитик**
- ✅ Привязка/отвязка сотрудников к организации
- ✅ Изменение ролей сотрудников своей организации (кроме `ecof_admin`)

**Ограничения:**
- ❌ Нет доступа к админ-панели аналитик (`/analytics/admin`)
- ❌ Не может управлять каталогом аналитик (создавать типы, добавлять значения)
- ❌ Не может управлять подписками других организаций
- ❌ Работает только в рамках своей организации (фильтрация по `organization_id`)
- ❌ Не может изменять роль администратора ЕЦОФ

**Использование:**
- Администраторы дочерних организаций (компаний)
- Ответственные за настройку и управление своей организацией на портале

---

### 3. **employee** — Сотрудник

**Описание:** Обычный сотрудник организации с правами на работу с документами.

**Права доступа:**
- ✅ Работа с документами и пакетами своей организации
- ✅ Просмотр и редактирование документов своей организации
- ✅ Создание и управление пакетами документов своей организации
- ✅ Отправка документов в 1С:УХ
- ✅ Просмотр справочников (НСИ)
- ✅ Просмотр отчетности своей организации

**Ограничения:**
- ❌ Не может управлять сотрудниками организации
- ❌ Не может настраивать подписки на аналитики
- ❌ Не может настраивать webhook
- ❌ Не может привязывать/отвязывать сотрудников
- ❌ Не может изменять роли сотрудников
- ❌ Работает только в рамках своей организации

**Использование:**
- Обычные сотрудники организаций
- Пользователи, работающие с документами на портале

---

## Сравнительная таблица прав доступа

| Функция | ecof_admin | org_admin | employee |
|---------|------------|-----------|----------|
| Работа с документами | ✅ Все организации | ✅ Своей организации | ✅ Своей организации |
| Управление пакетами | ✅ Все организации | ✅ Своей организации | ✅ Своей организации |
| Админ-панель аналитик | ✅ | ❌ | ❌ |
| Управление каталогом аналитик | ✅ | ❌ | ❌ |
| Настройка подписок аналитик | ✅ Все организации | ✅ Своей организации | ❌ |
| Управление сотрудниками | ✅ Все организации | ✅ Своей организации | ❌ |
| Настройка webhook | ✅ | ✅ Своей организации | ❌ |
| Интеграция с 1С:УХ | ✅ | ✅ | ✅ |
| Просмотр логов | ✅ | ✅ | ✅ |
| Управление НСИ | ✅ | ✅ | ✅ |

---

## Управление ролями

### Изменение роли сотрудника

Роль сотрудника можно изменить в **Личном кабинете организации** (`/organization/cabinet`) **только администраторами**:

1. Перейдите в раздел "Сотрудники"
2. Нажмите "Изменить роль" у нужного сотрудника
3. Выберите новую роль из списка:
   - `employee` — Сотрудник
   - `org_admin` — Администратор организации
   - `ecof_admin` — Администратор ЕЦОФ (только по назначению, обычно недоступен для выбора)

**Важно:** 
- Роль `ecof_admin` нельзя изменить через интерфейс личного кабинета (защищена от изменения)
- Только администраторы (`ecof_admin` или `org_admin`) могут изменять роли сотрудников

### Привязка сотрудника к организации

Сотрудника можно привязать к организации в **Личном кабинете организации** **только администраторами**:

1. Перейдите в раздел "Сотрудники"
2. Нажмите "Добавить сотрудника"
3. Найдите пользователя по имени или email
4. Выберите пользователя из результатов поиска
5. Пользователь будет привязан к вашей организации

**Важно:** Только администраторы (`ecof_admin` или `org_admin`) могут привязывать сотрудников к организации.

---

## Рекомендации по использованию ролей

1. **ecof_admin**: Используйте только для администраторов холдинга, ответственных за управление центральным каталогом аналитик и всей системой портала.

2. **org_admin**: Используйте для администраторов дочерних организаций, ответственных за настройку и управление своей организацией на портале.

3. **employee**: Используйте для обычных сотрудников организаций, работающих с документами на портале.

---

## Технические детали

- Роли хранятся в таблице `users` в поле `role`
- Проверка прав доступа выполняется через middleware:
  - `requireAdmin()` — только для `ecof_admin`
  - `requireOrgAdmin()` — для `ecof_admin` или `org_admin`
  - `requireRole(...roles)` — для указанных ролей
- На фронтенде роли используются для условного отображения элементов интерфейса
- Роль `ecof_admin` защищена от изменения в контроллере `updateEmployeeRole`

---

## Миграция со старой системы ролей

Если в системе были старые роли (`user`, `ecof_user`, `company_user`, `admin`), их нужно мигрировать:

- `admin` → `ecof_admin`
- `ecof_user` → `employee` или `org_admin` (в зависимости от потребностей)
- `company_user` → `org_admin` или `employee` (в зависимости от потребностей)
- `user` → `employee`
