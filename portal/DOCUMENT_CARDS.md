# Карточки документов первички

## Реализованные типы документов

### 1. Поступление товаров (накладная, УПД)
- **Тип**: `ReceiptGoods`
- **Путь**: `/documents/new/ReceiptGoods`
- **Поля**:
  - Основные реквизиты: номер, дата, контрагент, договор, счет на оплату, организация, склад
  - Флаги: есть расхождения, оригинал получен, УПД
  - Табличная часть: номенклатура, количество, единица, цена, сумма, НДС, всего
  - Итоги: общая сумма, НДС, итого с НДС

### 2. Поступление услуг (акт, УПД)
- **Тип**: `ReceiptServices`
- **Путь**: `/documents/new/ReceiptServices`
- **Поля**:
  - Основные реквизиты: номер, дата, контрагент, договор, счет на оплату, организация
  - Флаги: оригинал получен, УПД
  - Табличная часть: услуга, количество, единица, цена, сумма, НДС, всего
  - Итоги: общая сумма, НДС, итого с НДС

## Процесс работы с документами

1. **Создание**: Пользователь выбирает тип документа на странице `/documents/new`
2. **Заполнение**: Открывается форма создания с соответствующими полями
3. **Сохранение**: Документ сохраняется в статусе `Draft` (черновик)
4. **Заморозка**: После проверки документ можно заморозить (статус `Frozen`)
5. **Передача в УХ**: Замороженные документы передаются в 1С УХ через интеграционный слой

## Структура данных

Документы хранятся в БД портала с версионированием:
- Основная таблица `documents` — метаданные и статусы
- Таблица `document_versions` — версии документов с полными данными в JSONB
- Табличная часть (items) хранится внутри JSONB поля `data` версии документа

## Интеграция с УХ

После заморозки документа он попадает в очередь интеграции (`uh_integration_queue`) и передается в 1С УХ через HTTP-сервисы:
- Операция `UpsertDocument` — создание/обновление документа в УХ
- Операция `PostDocument` — проведение документа в УХ
- Статусы обрабатываются асинхронно и возвращаются в портал
