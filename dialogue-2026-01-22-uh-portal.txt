Дата: 2026-01-22
Тема: Портал (веб-интерфейс) + 1С:Управление холдингом (УХ) для ЕЦОФ, ввод первички, интеграция, производительность

---
USER:
Привет! Есть конфигурация 1С Управление холдингом. Можно ли для работы с ней разработать свой веб интерфейс или портал? Изучи задчу и предложи варианты.

ASSISTANT:
Да, с “1С:Управление холдингом” (УХ) можно сделать свой веб‑интерфейс/портал, но выбор зависит от сценариев и требований.

Важно уточнить: сценарии (просмотр/ввод/согласование), пользователи (внутренние/внешние), SSO, нагрузка/SLA, готовность дорабатывать УХ.

Варианты:
A — веб‑клиент 1С (быстро, поддерживаемо, но UX ограничен).
B — кастомный веб‑портал + API (HTTP‑сервисы 1С) (максимальный контроль UI/UX, нужен дизайн API и безопасность).
C — OData/витрины (быстро для read‑only, но для сложной логики нужен свой API).
D — портал на сторонней платформе (Bitrix/SharePoint) + интеграция с УХ (портальная оболочка + финмодуль).
E — прямой доступ к БД 1С (почти всегда не рекомендуется).

Рекомендация: начать с 1–3 ключевых пользовательских потоков и границы “что в 1С / что в портале”.

---
USER:
Варианты B и D скорее всего подходят. Задача следующая: Веб решение смаого 1С ужасное и долго работает. Система планируется очень больша я и емкая. Основные задачи, которые необходимо на портале: Первичные документы забиваются в портал(любым способом и скорее дочками), далее блокируются на изменения, далее попадают в УХ там проводятся, потом на этом основании сроиться отчетность РСБУ и упр отчетность. Всем этим занимются бухгалтера ЕЦОФ. Отчетность выгружается дочкам в портал. Дочки также могут получить первичку закрытую на изменения для своих нужд. Это если коротко. Портал должен повторять картчоки, должен работать быстро при больших нагрзуках.

ASSISTANT:
Понял: нужен быстрый портал “вокруг” УХ для массового ввода/хранения первички и выдачи отчетности, при этом УХ — финансовое ядро.

Ключевая мысль: для скорости на объёмах портал не должен быть “тонким UI к 1С на каждое действие”; нужно разделение контуров:
- Портал: сбор/управление первичкой + витрина/выдача (поиск, статусы, файлы, аудит).
- УХ: проведение, регламент, отчетность.
- Между ними: интеграционный слой (API/очереди/идемпотентность).

Вариант B (базовый): отдельный портал (UI + backend), БД портала, файловое хранилище, HTTP‑сервисы 1С + очередь (Rabbit/Kafka/Bus) для асинхронной обработки. Read‑модель/поиск (в т.ч. Elastic).

Процесс:
- Ввод первички в портале (формы/импорт/интеграции/файлы).
- Блокировка: лучше версионирование (v1 заморожена, правки → v2).
- Передача в УХ асинхронно пакетами; статус/ошибки обратно.
- Отчетность формируется в УХ, выгружается в портал дочкам.

Вариант D: корпоративная оболочка (Bitrix/SharePoint) + финмодуль как отдельное приложение/бекенд (чтобы не упереться в платформенные лимиты).

Просьба уточнить: типы первички/объемы/каналы загрузки/нужны ли согласования/формат отчетности/SSO и периметр.

---
USER:
Давай сначала разбирать связью портал и УХ. Есть опасения, что разделение БД на две части создаст рассинхрон данных. Рассматривается вариант создания единой базы для портала и 1С УХ. В этом случае данные сразу будут писаться в нужные регистры и не будет проблем с НСИ т.к. база будет единая. Возможен ли такой вариант реализации?

ASSISTANT:
Логика “одна БД = нет рассинхрона” понятна, но для 1С это почти всегда тупик.
В жизнеспособном виде “единая БД портала и УХ” с прямой записью в регистры/таблицы 1С — не рекомендуется:
- обход бизнес‑логики 1С, риски целостности;
- схема хранения 1С не является контрактом и меняется при обновлениях;
- высокая вероятность “тихой порчи данных” и проблем блокировок;
- плохая поддерживаемость.

Допустимый частный случай: у портала свои таблицы “рядом”, но не трогать таблицы 1С — это не решает НСИ само собой.

Как добиться согласованности без общей БД:
Вариант 1 — 1С как единственный источник истины, портал = UI + сервисы 1С (кэш справочников, пакетность, асинхронность).
Вариант 2 — портал как система первички, 1С = учетное ядро (очередь+outbox, идемпотентность, статусы, версионирование).

Уточнение: первичка больше как структурированные данные или как файлы+метаданные?

---
USER:
Варинат 1 хороший. Но вопрос такой, можно ли все сделать одну единую базу и не трогать таблицы 1С? Читаем НСИ из таблиц 1С напрямую без интеграций. Вносим данные в 1С через интегацию.

ASSISTANT:
Можно, но важно различать:
- один SQL Server/instance,
- и “одна SQL Database с таблицами 1С + таблицами портала”.

Технически “одна SQL Database и свои таблицы рядом” возможно, но для промышленной эксплуатации высокорисково:
- операции обновления/миграции/восстановления 1С могут задеть “чужие” объекты;
- сложности с backup/restore и переносами стендов;
- конкуренция за ресурсы БД.

Безопаснее: один SQL Server instance, но две отдельные SQL Database: `UH_DB` (только 1С) и `PORTAL_DB` (только портал).

Прямое чтение НСИ из таблиц 1С “без интеграций” — фактически интеграция через физическую модель 1С (нестабильно при обновлениях, обход прав, риск нагрузки). Лучше: мастер НСИ в УХ + реплика/кэш в портале через легкие HTTP‑сервисы (дельты).

Уточнение: НСИ — только справочники для выбора при вводе или ещё остатки/лимиты/план‑факт?

---
USER:
Я тебя понял. Я дал тебе вводные требования. Мы с тобой обсудили. Резюмируй и предложи по твоему мнению лучшее решение задачи портал + УХ. Предложи, что ты считаешь наиболее работоспособным, важно быстрым и безопасным.

ASSISTANT:
Резюме:
- УХ — ядро (проведение, регламент, РСБУ/упр отчетность).
- Портал — массовый ввод первички (в т.ч. дочками), заморозка, статусы, выдача отчетности и закрытой первички.
- Требования: скорость, безопасность, поддерживаемость.

Рекомендуемое решение:
Портал как отдельная система (своя БД + файловое хранилище) + УХ как учетное ядро + интеграция через сервисы 1С и очередь.

Как обеспечить согласованность:
- статусная модель + гарантированная доставка (outbox/очередь),
- идемпотентность,
- пакетная обработка,
- версионирование вместо “редактирования замороженного”.

НСИ:
- мастер = 1С, портал держит read‑кэш/реплику для скорости (дельты/события).

Вариант D (корп. портал) — как оболочка/SSO/навигация, а финмодуль первички лучше реализовать как ядро по варианту B.

---
USER:
Понимаешь в чем проблема, надо определить в этом случае необходимость двух систем - можно же тогда все делать в одной системе и ничего не придумывать, но я боюсь, что 1с не справится с таким объемом данных и пользователей. 1С не имеет хорошего решения данного кейса, 1с не имеет номарльно веб решения. Проект предполагет создания ЕЦОФ. Единого окна для бухгалтера куда он вносит докумнты, а на строне бэкенда происходят все вычисления.

ASSISTANT:
Да: “одна система” кажется проще, но на ЕЦОФ часто упирается в UX веб‑клиента 1С и пиковые нагрузки (закрытие периода), а также тяжелые сценарии поиска/витрин/файлов.

“Две системы” в правильной схеме — это одно решение из двух компонентов:
- Портал = единое окно (ввод/поиск/файлы/статусы/выдача),
- УХ = учетный двигатель (проведение/регламент/отчетность),
при этом пользователь работает только в портале, а 1С — backend.

Рекомендация: пилот/проверка 2–3 недели — замер нагрузки + тест пакетного создания/проведения через сервисы, параллельно UX‑прототип портала.

---
USER:
Разложи, да

ASSISTANT:
Целевая схема:
- Портал: пакеты первички, версии/заморозка, файлы, статусы, витрина/поиск, выдача отчетности.
- УХ: учетные документы 1С, проведение, регламент, отчетность.
- НСИ: мастер УХ, портал держит реплику/кэш для скорости.

Заморозка:
- версии `v1/v2/...`; “Frozen” неизменяемо; правки = новая версия.

Статусы (пример):
Draft → Validated → Frozen → QueuedToUH → SentToUH → AcceptedByUH → PostedInUH
или RejectedByUH (ошибка с диагностикой).
Пакет: New → InProcessing → PartiallyFailed/Failed/Done.

Связь портал↔УХ:
- только через HTTP‑контракты, не через SQL;
- асинхронно + outbox/очередь;
- идемпотентность, дедупликация;
- пакетная интеграция.

Минимальные контракты:
Из портала в УХ: CreateOrUpdateDocument, PostDocument, Attach/LinkFile (опционально).
Из УХ в портал: DocumentStatusChanged, NSI delta export, Report export.

Файлы: лучше хранить в портале (объектное хранилище), в УХ передавать ссылку/ID или файл по необходимости.

Вопрос-выбор: первичка в портале должна быть 1:1 структурированной как учетный документ или “файл + минимум метаданных” на старте.

---
